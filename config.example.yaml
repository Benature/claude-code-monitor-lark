# Claude监控系统配置文件
# 按功能模块分类组织，结构更清晰

# API数据源配置
api:
  base_url: "http://localhost:8000"     # API服务器基础URL
  
  # Claude账户数据API
  claude:
    bearer_token: "your_bearer_token_here"      # Claude API认证令牌
    endpoint: "/admin/claude-accounts"          # Claude账户数据端点路径
    timeout: 30                                 # 请求超时时间（秒）
    retry_attempts: 3                          # 重试次数
  
  # API密钥使用数据API  
  usage:
    endpoint: "/admin/api-keys"                 # API密钥使用数据端点路径
    timeout: 30
    retry_attempts: 3

# 数据存储配置
storage:
  claude_accounts_file: "claude_accounts.json"  # Claude账户数据文件
  api_usage_file: "api_keys_usage.json"        # API使用情况数据文件
  data_directory: "data"                        # 数据目录

# 通知系统配置
notification:
  enabled: true                                # 是否启用通知
  feishu:
    enabled: true                              # 是否启用飞书通知
    
    # 飞书机器人模式配置（二选一）：
    # 
    # 【模式1：Webhook模式】- 简单配置，只支持URL跳转按钮
    webhook_url: "https://open.feishu.cn/open-apis/bot/v2/hook/your_webhook_id"
    # 
    # 【模式2：应用模式】- 高级功能，支持回调按钮（取消下面注释使用）
    # app_id: "cli_your_app_id"                # 飞书应用ID
    # app_secret: "your_app_secret"            # 飞书应用Secret
    # chat_id: "oc_your_chat_id"               # 目标群聊ID（可选，不填则自动获取第一个群聊）
    # encrypt_key: "your_encrypt_key"          # 飞书加密密钥（可选，用于Challenge验证）
    # verification_token: "your_verification_token"  # 飞书验证Token（可选，用于Challenge验证）
    # 注意：如果配置了app_id和app_secret，将优先使用应用模式
    
    card_style: "rich"                         # 卡片样式：simple/rich
    
    # 飞书卡片按钮配置
    buttons:
      # 按钮动作类型：url(跳转) | callback(回调)
      # 注意：callback模式仅在使用app_id/app_secret时可用
      action_type: "url"                       # 默认使用URL跳转
      
      # 卡片按钮URL基础地址（可能与服务器host:port不同）
      base_url: "http://your-domain.com:8155"  # 外部访问地址，如果为空则使用server的host:port
      
      # URL跳转模式配置（当action_type为"url"时生效）
      url_actions:
        - text: "监控账户状态"                  # 按钮显示文本
          command: "monitor_accounts"           # 对应的API命令
          style: "default"                     # 按钮样式：default/primary/danger
        - text: "监控API使用情况"
          command: "monitor_api_usage"
          style: "default"
        - text: "完整监控"
          command: "full_monitor" 
          style: "primary"
      
      # 回调模式配置（当action_type为"callback"时生效，仅限应用模式）  
      callback_actions:
        - text: "监控账户状态"                  # 按钮显示文本
          value: "monitor_accounts"             # 回调值
          style: "default"                     # 按钮样式
        - text: "监控API使用情况"
          value: "monitor_api_usage"
          style: "default"
        - text: "完整监控"
          value: "full_monitor"
          style: "primary"

# FastAPI服务器配置
server:
  host: "localhost"                            # 服务器地址
  port: 8155                                   # 服务器端口
  
  # 认证配置
  auth:
    # api_key: "your_fastapi_access_key_here"    # API访问密钥
    # api_secret: "your_fastapi_secret_key_here" # API密钥签名
    # require_signature: false                   # 是否需要HMAC签名验证
    simple_key: "your_simple_key_here"         # 简单URL参数验证密钥
  
  # 服务器运行配置
  workers: 1                                   # 工作进程数
  reload: false                                # 开发模式热重载
  log_level: "info"                            # 日志级别

# 系统配置
system:
  timezone: "Asia/Shanghai"                    # 时区设置
  log_level: "INFO"                           # 系统日志级别
  encoding: "utf-8"                           # 文件编码

# 监控配置
monitoring:
  check_interval: 300                         # 检查间隔（秒）
  rate_limit_threshold: 10                    # 限流阈值（分钟）
  notification_cooldown: 300                  # 通知冷却时间（秒）

# =====================================
# 飞书机器人配置示例
# =====================================
# 
# 【示例1：Webhook模式配置】
# notification:
#   feishu:
#     enabled: true
#     webhook_url: "https://open.feishu.cn/open-apis/bot/v2/hook/your_webhook_id"
#     buttons:
#       action_type: "url"
#       url_actions:
#         - text: "🔍 监控账户状态"
#           command: "monitor_accounts"
#           style: "default"
#         - text: "📊 监控API使用情况"
#           command: "monitor_api_usage"
#           style: "default"
#         - text: "🚀 完整监控"
#           command: "full_monitor"
#           style: "primary"
# 
# 【示例2：应用模式配置（支持回调）】
# notification:
#   feishu:
#     enabled: true
#     app_id: "cli_your_app_id"
#     app_secret: "your_app_secret"
#     chat_id: "oc_your_chat_id"               # 可选：指定群聊ID，不填则自动获取第一个群聊
#     encrypt_key: "your_encrypt_key"          # 可选：飞书加密密钥，用于Challenge验证
#     verification_token: "your_verification_token"  # 可选：飞书验证Token，用于Challenge验证
#     buttons:
#       action_type: "callback"
#       callback_actions:
#         - text: "🔍 监控账户状态"
#           value: "monitor_accounts"
#           style: "default"
#         - text: "📊 监控API使用情况"
#           value: "monitor_api_usage"
#           style: "default"
#         - text: "🚀 完整监控"
#           value: "full_monitor"
#           style: "primary"
#
# =====================================
# 飞书 Challenge 验证说明
# =====================================
#
# 飞书开放平台为了验证回调URL的有效性，会发送Challenge验证请求。
# 系统支持两种验证模式：
#
# 1. 明文模式（未配置encrypt_key）：
#    飞书直接发送包含challenge字段的JSON请求
#    系统直接解析并返回challenge值
#
# 2. 加密模式（已配置encrypt_key）：
#    飞书发送加密的challenge请求
#    系统使用encrypt_key解密后返回challenge值
#
# 配置说明：
# - encrypt_key: 在飞书开放平台应用设置中配置的Encrypt Key
# - verification_token: 在飞书开放平台应用设置中配置的Verification Token
# - 两者都是可选配置，但推荐配置以提高安全性